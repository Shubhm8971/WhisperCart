<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhisperCart - AI Shopping Assistant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; color: white; margin-bottom: 40px; }
        .logo { font-size: 4em; font-weight: bold; margin-bottom: 10px; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); }
        .tagline { font-size: 1.3em; opacity: 0.9; margin-bottom: 20px; }
        .highlight { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin: 20px 0; }

        .demo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        .demo-card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .demo-card:hover { transform: translateY(-5px); }

        .demo-title { font-size: 1.5em; color: #667eea; margin-bottom: 20px; text-align: center; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 16px; }

        .btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }

        .result-box { background: #f8f9fa; border-left: 4px solid #667eea; padding: 20px; margin-top: 20px; border-radius: 10px; }
        .success { background: #e8f5e8; border-left-color: #4CAF50; }
        .error { background: #ffebee; border-left-color: #f44336; }

        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { background: white; padding: 20px; border-radius: 15px; border: 2px solid #f0f0f0; transition: all 0.3s ease; }
        .product-card:hover { border-color: #667eea; transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }

        .product-emoji { font-size: 2em; text-align: center; margin-bottom: 10px; }
        .product-name { font-weight: bold; color: #333; margin-bottom: 8px; }
        .product-price { color: #4CAF50; font-size: 1.2em; font-weight: bold; margin-bottom: 8px; }
        .product-store { color: #666; font-size: 14px; margin-bottom: 10px; }
        .savings-badge { background: #4CAF50; color: white; padding: 4px 8px; border-radius: 15px; font-size: 12px; display: inline-block; }

        .stats-bar { background: white; padding: 20px; border-radius: 15px; margin-top: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; text-align: center; }
        .stat-value { font-size: 2em; font-weight: bold; color: #667eea; }
        .stat-label { color: #666; font-size: 14px; margin-top: 5px; }

        .story-section { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 20px; margin: 40px 0; }
        .story-title { font-size: 2em; color: #333; margin-bottom: 20px; text-align: center; }
        .story-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-top: 30px; }

        .step { text-align: center; }
        .step-number { width: 60px; height: 60px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin: 0 auto 15px; }
        .step-title { font-size: 1.2em; font-weight: bold; color: #333; margin-bottom: 10px; }
        .step-desc { color: #666; line-height: 1.5; }

        .cta-section { text-align: center; background: white; padding: 40px; border-radius: 20px; margin-top: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .cta-title { font-size: 2.5em; color: #667eea; margin-bottom: 20px; }
        .cta-subtitle { font-size: 1.2em; color: #666; margin-bottom: 30px; }

        /* User Registration Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 2px solid #667eea;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            margin-top: -10px;
            margin-right: -10px;
        }
        .close:hover { color: #667eea; }
        .user-info { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px; }
        .user-tier { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .tier-free { background: #4CAF50; color: white; }
        .tier-pro { background: #667eea; color: white; }
        .tier-business { background: #FF9800; color: white; }

        /* Product Modal */
        #productModal {
            z-index: 10001;
        }
        #productModal .modal-content {
            max-width: 1000px;
            min-height: 700px;
            max-height: 90vh;
            overflow-y: auto;
            margin: 2% auto;
        }
        .product-details {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .product-details-emoji { font-size: 4em; margin-bottom: 20px; }
        .product-details-name { font-size: 2em; font-weight: bold; color: #333; margin-bottom: 15px; line-height: 1.4; }
        .product-details-price { font-size: 2.5em; color: #4CAF50; font-weight: bold; margin-bottom: 15px; }
        .product-details-store { color: #666; margin-bottom: 20px; font-size: 18px; }
        .product-details-savings { background: #4CAF50; color: white; padding: 12px 20px; border-radius: 25px; display: inline-block; margin-bottom: 25px; font-size: 16px; font-weight: bold; }
        .purchase-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 20px;
            margin-top: 20px;
        }
        .tier-benefits {
            background: #fff3cd;
            color: #856404;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.7;
            border: 3px solid #ffeaa7;
        }
        .purchase-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            transition: all 0.3s ease;
        }
        .purchase-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.5);
        }

        @media (max-width: 768px) {
            .demo-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .story-grid { grid-template-columns: 1fr; }
            .logo { font-size: 3em; }
            .modal-content { margin: 20% auto; width: 95%; }
        }
    </style>
</head>
<body>
    <!-- User Registration Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="color: #667eea; margin-bottom: 20px;">Join WhisperCart</h2>

            <div id="registerForm">
                <div class="input-group">
                    <label>Name</label>
                    <input type="text" id="regName" placeholder="Your full name">
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="regEmail" placeholder="your@email.com">
                </div>
                <div class="input-group">
                    <label>Choose Plan</label>
                    <select id="regPlan">
                        <option value="free">Free Plan (‚Çπ0)</option>
                        <option value="pro">Pro Plan (‚Çπ299/month)</option>
                        <option value="business">Business Plan (‚Çπ999/month)</option>
                    </select>
                </div>
                <button class="btn" onclick="registerUser()" style="width: 100%; margin-bottom: 15px;">Create Account</button>
                <p style="text-align: center; color: #666; margin-bottom: 15px;">Already have an account?</p>
                <button class="btn" onclick="showLogin()" style="width: 100%; background: #4CAF50;">Login Instead</button>
            </div>

            <div id="loginForm" style="display: none;">
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com">
                </div>
                <button class="btn" onclick="loginUser()" style="width: 100%; margin-bottom: 15px;">Login</button>
                <p style="text-align: center; color: #666; margin-bottom: 15px;">New to WhisperCart?</p>
                <button class="btn" onclick="showRegister()" style="width: 100%; background: #4CAF50;">Create Account</button>
            </div>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close" id="productModalClose" onclick="closeProductModal()">&times;</span>
            <div class="product-details">
                <div id="productEmoji" class="product-details-emoji">üõí</div>
                <div id="productName" class="product-details-name">Product Name</div>
                <div id="productPrice" class="product-details-price">‚Çπ0</div>
                <div id="productStore" class="product-details-store">Store Name</div>
                <div id="productSavings" class="product-details-savings">Save ‚Çπ0</div>
            </div>

            <div class="purchase-section">
                <h3 style="color: #667eea; margin-bottom: 15px;">Ready to Purchase?</h3>
                <p style="color: #666; margin-bottom: 20px;">
                    You'll be redirected to the official store website to complete your purchase.
                    WhisperCart earns a commission on successful sales.
                </p>

                <div id="tierBenefits" style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <!-- Dynamic tier benefits will be inserted here -->
                </div>

                <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <strong style="color: #2e7d32;">üéØ Demo Mode Active</strong><br>
                    <small style="color: #388e3c;">This demonstrates WhisperCart's AI shopping capabilities.<br>
                    Real affiliate links will be integrated in production.</small>
                </div>

                <button id="purchaseBtn" class="purchase-btn" onclick="demoPurchase()">üéØ Experience AI Shopping</button>

                <p style="text-align: center; color: #999; font-size: 12px; margin-top: 10px;">
                    AI-powered price comparison ‚Ä¢ Smart recommendations ‚Ä¢ Real-time deals
                </p>
            </div>
        </div>
    </div>

    <div class="container">
        <header class="header">
            <div class="logo">üõí WhisperCart</div>
            <div class="tagline">The Future of AI-Powered Shopping</div>
            <div class="highlight">
                <strong>üéØ Problem:</strong> People waste hours comparing prices manually<br>
                <strong>üí° Solution:</strong> AI does it instantly with voice commands<br>
                <strong>üöÄ Result:</strong> Save time, money, and frustration
            </div>

            <!-- User Status Bar -->
            <div id="userBar" style="display: none; background: rgba(255,255,255,0.95); color: #333; padding: 20px; border-radius: 15px; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <div id="userInfo" style="text-align: center; margin-bottom: 15px;"></div>
                <div id="userDashboard" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;"></div>
                <div style="text-align: center;">
                    <button class="btn" onclick="logoutUser()" style="padding: 8px 16px; font-size: 14px; background: #f44336;">Logout</button>
                </div>
            </div>
        </header>

        <div class="demo-grid">
            <div class="demo-card">
                <div class="demo-title">üé§ Voice Shopping Demo</div>
                <div class="input-group">
                    <label>What do you want to buy?</label>
                    <input type="text" id="voiceInput" placeholder="Try: 'I want running shoes under 3000 rupees'" value="I want running shoes under 3000 rupees">
                </div>
                <button class="btn" onclick="processVoice()" style="width: 100%; margin-bottom: 10px;">ü§ñ Ask AI Assistant</button>
                <button class="btn" onclick="showRandomDemo()" style="width: 100%; background: #4CAF50;">üé≤ Show Random Demo</button>
                <div id="voiceResult"></div>
            </div>

            <div class="demo-card">
                <div class="demo-title">üõí Product Search Demo</div>
                <div class="input-group">
                    <label>Category</label>
                    <select id="category">
                        <option value="running shoes">Running Shoes</option>
                        <option value="smartphones">Smartphones</option>
                        <option value="laptops">Laptops</option>
                        <option value="headphones">Headphones</option>
                        <option value="watches">Smart Watches</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Budget (‚Çπ)</label>
                    <input type="number" id="budget" placeholder="3000" value="3000">
                </div>
                <button class="btn" onclick="searchProducts()" style="width: 100%;">üîç Find Best Deals</button>
                <div id="searchResult"></div>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stats-grid">
                <div>
                    <div class="stat-value" id="searches">0</div>
                    <div class="stat-label">Searches Made</div>
                </div>
                <div>
                    <div class="stat-value" id="savings">‚Çπ0</div>
                    <div class="stat-label">Money Saved</div>
                </div>
                <div>
                    <div class="stat-value" id="products">0</div>
                    <div class="stat-label">Products Found</div>
                </div>
                <div>
                    <div class="stat-value" id="negotiations">0</div>
                    <div class="stat-label">AI Negotiations</div>
                </div>
            </div>
        </div>

        <div class="story-section">
            <div class="story-title">How WhisperCart Revolutionizes Shopping</div>

            <div class="story-grid">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-title">üé§ Speak Naturally</div>
                    <div class="step-desc">Simply tell WhisperCart what you're looking for. No typing, no complex searches - just natural conversation.</div>
                </div>

                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-title">ü§ñ AI Understanding</div>
                    <div class="step-desc">Advanced AI analyzes your request, understands context, and identifies your exact needs and budget.</div>
                </div>

                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-title">üõí Instant Search</div>
                    <div class="step-desc">AI searches across multiple e-commerce platforms simultaneously to find the best deals.</div>
                </div>

                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-title">üí∞ Smart Negotiation</div>
                    <div class="step-desc">AI negotiates better prices automatically, showing you exactly how much you save with each deal.</div>
                </div>

                <div class="step">
                    <div class="step-number">5</div>
                    <div class="step-title">üõçÔ∏è Easy Purchase</div>
                    <div class="step-desc">Direct affiliate links to complete your purchase with confidence and peace of mind.</div>
                </div>

                <div class="step">
                    <div class="step-number">6</div>
                    <div class="step-title">üìä Learning Growth</div>
                    <div class="step-desc">AI learns your preferences and gets smarter, providing even better recommendations over time.</div>
                </div>
            </div>
        </div>

        <div class="cta-section">
            <div class="cta-title">üöÄ Choose Your WhisperCart Plan</div>
            <div class="cta-subtitle">
                Start free and upgrade as your shopping needs grow.<br>
                Cancel anytime, no hidden fees.
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                <div style="background: white; padding: 25px; border-radius: 15px; border: 2px solid #e1e5e9; text-align: center;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üÜì Free</h3>
                    <div style="font-size: 2em; font-weight: bold; color: #667eea; margin: 15px 0;">‚Çπ0</div>
                    <div style="color: #666; margin-bottom: 20px;">Forever free</div>
                    <ul style="text-align: left; color: #555; line-height: 1.6; margin-bottom: 20px;">
                        <li>‚úÖ Basic AI product search</li>
                        <li>‚úÖ Voice shopping requests</li>
                        <li>‚úÖ Price comparison (up to ‚Çπ3000)</li>
                        <li>‚úÖ 5 searches per day</li>
                        <li>‚úÖ Email support</li>
                    </ul>
                    <button class="btn" style="width: 100%; background: #4CAF50;">Get Started Free</button>
                </div>

                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; border: 3px solid #667eea; text-align: center; transform: scale(1.05);">
                    <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: #FF9800; color: white; padding: 5px 15px; border-radius: 15px; font-size: 12px; font-weight: bold;">Most Popular</div>
                    <h3 style="margin-bottom: 15px;">‚≠ê Pro</h3>
                    <div style="font-size: 2em; font-weight: bold; margin: 15px 0;">‚Çπ299</div>
                    <div style="opacity: 0.9; margin-bottom: 20px;">per month</div>
                    <ul style="text-align: left; line-height: 1.6; margin-bottom: 20px;">
                        <li>‚úÖ Everything in Free</li>
                        <li>‚úÖ Unlimited searches</li>
                        <li>‚úÖ Advanced AI filters</li>
                        <li>‚úÖ Deal alerts & notifications</li>
                        <li>‚úÖ Priority customer support</li>
                        <li>‚úÖ Export shopping lists</li>
                        <li>‚úÖ Price history tracking</li>
                    </ul>
                    <button class="btn" style="width: 100%; background: white; color: #667eea;">Start Pro Trial</button>
                </div>

                <div style="background: white; padding: 25px; border-radius: 15px; border: 2px solid #e1e5e9; text-align: center;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üè¢ Business</h3>
                    <div style="font-size: 2em; font-weight: bold; color: #667eea; margin: 15px 0;">‚Çπ999</div>
                    <div style="color: #666; margin-bottom: 20px;">per month</div>
                    <ul style="text-align: left; color: #555; line-height: 1.6; margin-bottom: 20px;">
                        <li>‚úÖ Everything in Pro</li>
                        <li>‚úÖ White-label API access</li>
                        <li>‚úÖ Custom integrations</li>
                        <li>‚úÖ Team collaboration tools</li>
                        <li>‚úÖ Advanced analytics</li>
                        <li>‚úÖ Dedicated account manager</li>
                        <li>‚úÖ Custom AI training</li>
                    </ul>
                    <button class="btn" style="width: 100%;">Contact Sales</button>
                </div>
            </div>

            <div style="margin-top: 40px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                <strong>üìß Contact:</strong> shubhmittal8971wc@gmail.com<br>
                <strong>üíº Business:</strong> AI Shopping Assistant Startup<br>
                <strong>üéØ Mission:</strong> Make online shopping effortless and affordable for everyone<br>
                <strong>üí≥ Payments:</strong> Secure payments via Razorpay | Cancel anytime
            </div>
        </div>
    </div>

    <script>
        // SHOPIFY STORES - REAL INDIAN BRANDS WITH PUBLIC APIs
        const SHOPIFY_STORES = {
            nykaa: {
                domain: 'www.nykaa.com',
                storefrontAccessToken: null, // Public access
                categories: ['beauty', 'skincare', 'haircare']
            },
            bombaystore: {
                domain: 'www.thebombaystore.com',
                storefrontAccessToken: null,
                categories: ['home', 'decor', 'gifts']
            },
            mamaearth: {
                domain: 'mamaearth.in',
                storefrontAccessToken: null,
                categories: ['baby', 'skincare', 'haircare']
            },
            bungalow: {
                domain: 'www.bungalow.in',
                storefrontAccessToken: null,
                categories: ['clothing', 'fashion', 'accessories']
            }
        };

        // Product database loaded from Shopify APIs
        let products = {};
        let allProducts = [];

        // SHOPIFY API INTEGRATION FUNCTIONS
        async function searchShopifyStore(storeDomain, query) {
            try {
                // Use Shopify's search/suggest endpoint (public access)
                const url = `https://${storeDomain}/search/suggest.json?q=${encodeURIComponent(query)}&resources[type]=product&resources[limit]=10`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.resources && data.resources.results) {
                    return data.resources.results.products.map(product => ({
                        name: product.title,
                        price: Math.round(parseFloat(product.price) * 83), // USD to INR conversion
                        store: storeDomain.replace('www.', '').replace('.com', '').replace('.in', ''),
                        emoji: getEmojiForStore(storeDomain),
                        image: product.image,
                        url: `https://${storeDomain}/products/${product.handle}`,
                        asin: product.id.toString() // Use product ID as fallback
                    }));
                }
                return [];
            } catch (error) {
                console.log(`Shopify API error for ${storeDomain}:`, error);
                return [];
            }
        }

        function getEmojiForStore(domain) {
            if (domain.includes('nykaa')) return 'üíÑ';
            if (domain.includes('mamaearth')) return 'üß¥';
            if (domain.includes('bombaystore')) return 'üè∫';
            if (domain.includes('bungalow')) return 'üëó';
            return 'üõí';
        }

        // Load products from multiple Shopify stores
        async function loadShopifyProducts() {
            console.log('Loading real products from Shopify stores...');
            allProducts = [];

            const searchQueries = ['face cream', 'laptop', 'shoes', 'watch', 'headphones'];

            for (const [storeKey, storeConfig] of Object.entries(SHOPIFY_STORES)) {
                try {
                    for (const query of searchQueries.slice(0, 2)) { // Limit queries per store
                        const storeProducts = await searchShopifyStore(storeConfig.domain, query);
                        allProducts.push(...storeProducts);
                        console.log(`Loaded ${storeProducts.length} products from ${storeKey}`);
                    }
                } catch (error) {
                    console.log(`Failed to load from ${storeKey}:`, error);
                }
            }

            // Organize products by category
            organizeProductsByCategory();
            console.log(`Total products loaded: ${allProducts.length}`);
        }

        function organizeProductsByCategory() {
            // Simple category mapping based on keywords
            products = {
                'running shoes': allProducts.filter(p =>
                    p.name.toLowerCase().includes('shoe') ||
                    p.name.toLowerCase().includes('sneaker') ||
                    p.name.toLowerCase().includes('running')
                ),
                'smartphones': allProducts.filter(p =>
                    p.name.toLowerCase().includes('phone') ||
                    p.name.toLowerCase().includes('mobile') ||
                    p.name.toLowerCase().includes('smartphone')
                ),
                'laptops': allProducts.filter(p =>
                    p.name.toLowerCase().includes('laptop') ||
                    p.name.toLowerCase().includes('computer') ||
                    p.name.toLowerCase().includes('notebook')
                ),
                'headphones': allProducts.filter(p =>
                    p.name.toLowerCase().includes('headphone') ||
                    p.name.toLowerCase().includes('earphone') ||
                    p.name.toLowerCase().includes('earbud')
                ),
                'watches': allProducts.filter(p =>
                    p.name.toLowerCase().includes('watch') ||
                    p.name.toLowerCase().includes('smartwatch')
                )
            };

            // Add fallback products if categories are empty
            addFallbackProducts();
        }

        function addFallbackProducts() {
            const fallbackProducts = {
                'running shoes': [
                    {name: 'Nike Air Zoom Pegasus 39', price: 8999, store: 'Nike', emoji: 'üëü', url: 'https://www.nike.com/in/t/air-zoom-pegasus-39-mens-road-running-shoes-NCz8Qw/DD9465-001', asin: 'demo1'},
                    {name: 'Adidas Ultraboost 22', price: 6999, store: 'Adidas', emoji: 'üëü', url: 'https://www.adidas.co.in/ultraboost-22-shoes/GZ7990.html', asin: 'demo2'},
                    {name: 'Puma Deviate Nitro 2', price: 2499, store: 'Puma', emoji: 'üëü', url: 'https://www.puma.com', asin: 'demo3'},
                    {name: 'Reebok Flexagon Force 3', price: 1899, store: 'Reebok', emoji: 'üëü', url: 'https://www.reebok.com', asin: 'demo4'}
                ],
                'smartphones': [
                    {name: 'Samsung Galaxy A14', price: 16499, store: 'Samsung', emoji: 'üì±', url: 'https://www.samsung.com/in/smartphones/galaxy-a/galaxy-a14-5g-awesome-silver-128gb-sm-a146bzsains/', asin: 'demo3'},
                    {name: 'OnePlus Nord CE 3', price: 19999, store: 'OnePlus', emoji: 'üì±', url: 'https://www.oneplus.in/oneplus-nord-ce-3-lite', asin: 'demo4'}
                ],
                'laptops': [
                    {name: 'Lenovo IdeaPad Slim 3', price: 34999, store: 'Lenovo', emoji: 'üíª', url: 'https://www.lenovo.com/in/en/p/laptops/ideapad/ideapad-slim-3-gen-8-(14-inch-amd)/82xq0007in', asin: 'demo5'},
                    {name: 'HP 15s', price: 27999, store: 'HP', emoji: 'üíª', url: 'https://www.hp.com/in-en/shop/hp-15s-amd-ryzen-3-laptop-15s-eq2143au-699w1pa.html', asin: 'demo6'}
                ],
                'headphones': [
                    {name: 'Sony WF-1000XM4', price: 15999, store: 'Sony', emoji: 'üéß', url: 'https://www.sony.co.in/electronics/headphones/wf-1000xm4', asin: 'demo7'},
                    {name: 'JBL Tune 230NC', price: 3999, store: 'JBL', emoji: 'üéß', url: 'https://www.jbl.com/bluetooth-headphones/TUNE230NC.html', asin: 'demo8'}
                ],
                'watches': [
                    {name: 'Noise ColorFit Pro 4', price: 3999, store: 'Noise', emoji: '‚åö', url: 'https://www.gonoise.com/products/noise-colorfit-pro-4-1-72-display-bluetooth-calling-10-day-battery-life', asin: 'demo9'},
                    {name: 'boAt Wave Call', price: 1999, store: 'boAt', emoji: '‚åö', url: 'https://www.boat-lifestyle.com/products/boat-wave-call-smart-watch', asin: 'demo10'}
                ]
            };

            // Add fallback products to empty categories
            for (const [category, productList] of Object.entries(products)) {
                if (productList.length === 0) {
                    products[category] = fallbackProducts[category] || [];
                }
            }
        }

        // Function to generate affiliate/store URLs
        function generateAffiliateUrl(url) {
            // For Shopify stores, use direct URLs
            // For demo products, create working placeholder links
            if (url && url !== '#') {
                return url; // Direct Shopify store URL
            } else {
                // Demo product - redirect to a working page
                return `https://www.google.com/search?q=${encodeURIComponent('buy ' + 'demo product')}`;
            }
        }

        // Function to open affiliate/store links
        function openAffiliateLink(url) {
            if (url.includes('example.com')) {
                alert(`üéØ Demo Product Link:\n${url}\n\nüìù This is a demo link for testing.\nüí∞ Real affiliate commissions coming soon!\n\nüì± Link will open in new tab.`);
            } else {
                alert(`üéØ Store Link:\n${url}\n\n‚úÖ Direct link to product on store website\nüí∞ You earn commission on purchases!\n\nüì± Link will open in new tab.`);
            }
            window.open(url, '_blank');
            console.log('üéØ Store link clicked:', url);
        }

        let stats = { searches: 0, savings: 0, products: 0, negotiations: 0 };

        function processVoice() {
            const input = document.getElementById('voiceInput').value.trim();
            if (!input) {
                showResult('voiceResult', 'Please enter what you want to search for!', 'error');
                return;
            }

            // AI processing animation
            showResult('voiceResult', '<div style="text-align: center;"><div style="font-size: 2em; margin-bottom: 10px;">üé§</div>Processing your voice request...<br><em>AI analyzing: "' + input + '"</em></div>', 'success');

            setTimeout(() => {
                // AI intent analysis
                let category = 'running shoes';
                let budget = 3000;

                const text = input.toLowerCase();

                if (text.includes('headphone')) {
                    category = 'headphones';
                } else if (text.includes('smartphone') || text.includes('phone')) {
                    category = 'smartphones';
                } else if (text.includes('laptop')) {
                    category = 'laptops';
                } else if (text.includes('watch')) {
                    category = 'watches';
                }

                // Extract budget
                const budgetMatch = text.match(/(\d+)/);
                if (budgetMatch) {
                    budget = parseInt(budgetMatch[0]);
                }

                showResult('voiceResult',
                    `<strong>üéØ AI Understood:</strong><br>
                    ‚Ä¢ Product: ${category}<br>
                    ‚Ä¢ Budget: ‚Çπ${budget}<br>
                    <strong>ü§ñ Searching for best deals...</strong>`, 'success');

                setTimeout(() => {
                    console.log('Voice processing: Calling searchProductsByCategory', category, budget);
                    try {
                        searchProductsByCategory(category, budget, 'voiceResult');
                    } catch (error) {
                        console.error('Voice processing error:', error);
                        showResult('voiceResult', '‚ùå Sorry, there was an error processing your request. Please try again.', 'error');
                    }
                }, 1500);
            }, 1000);
        }

        function showRandomDemo() {
            const demos = [
                "I want headphones under 5000 rupees",
                "Find me a smartphone within 20000",
                "Show me running shoes under 3000",
                "I need a gaming laptop under 60000",
                "Get me a smartwatch under 3000"
            ];

            const randomDemo = demos[Math.floor(Math.random() * demos.length)];
            document.getElementById('voiceInput').value = randomDemo;
            processVoice();
        }

        function searchProducts() {
            const category = document.getElementById('category').value;
            const budget = parseInt(document.getElementById('budget').value) || 3000;
            searchProductsByCategory(category, budget, 'searchResult');
        }

        function searchProductsByCategory(category, budget, resultDiv) {
            console.log('Searching products:', { category, budget, resultDiv });
            console.log('Available products:', products);
            console.log('Category products:', products[category]);

            const categoryProducts = products[category] || [];
            console.log('Category products found:', categoryProducts.length);

            let affordable = categoryProducts.filter(p => p.price <= budget);
            console.log('Affordable products:', affordable.length);

            if (affordable.length === 0) {
                showResult(resultDiv, `üòî No ${category} found within ‚Çπ${budget} budget. Try increasing your budget!`, 'error');
                return;
            }

            // Sort by best value (AI negotiation algorithm)
            affordable.sort((a, b) => a.price - b.price);

            // Apply subscription-based pricing and features
            let userTier = 'free';
            let discountRate = 0.85; // Base AI negotiation
            let exclusiveDeals = false;
            let bulkDiscounts = false;

            if (currentUser) {
                userTier = currentUser.plan;
                if (userTier === 'pro') {
                    discountRate = 0.75; // Better deals for Pro users
                    exclusiveDeals = true;
                } else if (userTier === 'business') {
                    discountRate = 0.70; // Best deals for Business users
                    exclusiveDeals = true;
                    bulkDiscounts = true;
                }
            }

            let html = `<div class="result-box success">
                <strong>üéâ AI Found ${affordable.length} Great Deals!</strong><br>
                <em>Sorted by best value${userTier !== 'free' ? ' with exclusive ' + userTier.toUpperCase() + ' discounts' : ' with AI-negotiated prices'}</em>
            </div>`;

            // Add tier-specific messaging
            if (userTier === 'free') {
                html += `<div style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 14px;">
                    <strong>‚≠ê Upgrade to Pro:</strong> Get exclusive deals up to 25% off + unlimited searches!
                    <button class="btn" onclick="document.querySelector('.cta-section').scrollIntoView({behavior: 'smooth'})" style="padding: 5px 10px; font-size: 12px; margin-left: 10px;">Upgrade Now</button>
                </div>`;
            } else if (userTier === 'pro') {
                html += `<div style="background: #d1ecf1; color: #0c5460; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 14px;">
                    <strong>üöÄ Pro Exclusive:</strong> Enjoy 25% better deals + premium AI features!
                </div>`;
            } else if (userTier === 'business') {
                html += `<div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 14px;">
                    <strong>üè¢ Business Elite:</strong> Maximum 30% savings + bulk discounts available!
                </div>`;
            }

            html += '<div class="product-grid">';

            affordable.slice(0, 4).forEach(product => {
                const negotiatedPrice = Math.round(product.price * discountRate);
                const savings = product.price - negotiatedPrice;
                const affiliateUrl = generateAffiliateUrl(product.url);

                let productBadge = '';
                if (exclusiveDeals && userTier === 'pro') {
                    productBadge = '<div style="background: #667eea; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-bottom: 5px; display: inline-block;">PRO EXCLUSIVE</div>';
                } else if (bulkDiscounts && userTier === 'business') {
                    productBadge = '<div style="background: #FF9800; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-bottom: 5px; display: inline-block;">BULK DISCOUNT</div>';
                }

                const productIndex = affordable.indexOf(product); // Get product index for reference

                html += `
                    <div class="product-card" onclick="showProductInfo('${resultDiv}', ${productIndex}, '${category}', ${negotiatedPrice}, '${product.store}', ${savings}, '${userTier}', '${product.name.replace(/'/g, "\\'")}', '${product.url}')" style="cursor: pointer;">
                        ${productBadge}
                        <div class="product-emoji">${product.emoji}</div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">‚Çπ${negotiatedPrice.toLocaleString()}</div>
                        <div class="product-store">${product.store}</div>
                        <div class="savings-badge">Save ‚Çπ${savings.toLocaleString()}</div>
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            ü§ñ AI-negotiated price
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            document.getElementById(resultDiv).innerHTML = html;

            // Update stats
            stats.searches++;
            stats.products += affordable.length;
            stats.negotiations += affordable.slice(0, 4).length;
            stats.savings += affordable.slice(0, 4).reduce((sum, p) => sum + (p.price - Math.round(p.price * discountRate)), 0);

            updateStats();
        }

        function showResult(divId, message, type = 'info') {
            const div = document.getElementById(divId);
            let className = 'result-box';
            if (type === 'success') className += ' success';
            if (type === 'error') className += ' error';

            div.innerHTML = `<div class="${className}">${message}</div>`;
        }

        function updateStats() {
            document.getElementById('searches').textContent = stats.searches;
            document.getElementById('savings').textContent = '‚Çπ' + stats.savings.toLocaleString();
            document.getElementById('products').textContent = stats.products;
            document.getElementById('negotiations').textContent = stats.negotiations;
        }

        // USER MANAGEMENT SYSTEM
        let currentUser = null;

        // Load user data and products on page load
        window.onload = async function() {
            // Load real products from Shopify stores
            await loadShopifyProducts();

            // Load user data and update UI
            loadUserData();
            updateUIForUser();
        };

        function loadUserData() {
            const userData = localStorage.getItem('whispercart_user');
            if (userData) {
                currentUser = JSON.parse(userData);
            }
        }

        function saveUserData() {
            if (currentUser) {
                localStorage.setItem('whispercart_user', JSON.stringify(currentUser));
            }
        }

        function updateUIForUser() {
            const userBar = document.getElementById('userBar');
            const userInfo = document.getElementById('userInfo');
            const userDashboard = document.getElementById('userDashboard');

            if (currentUser) {
                userBar.style.display = 'block';
                const tierClass = `tier-${currentUser.plan}`;

                // Personalized greeting
                const now = new Date();
                const hour = now.getHours();
                let greeting = 'Hello';
                if (hour < 12) greeting = 'Good morning';
                else if (hour < 17) greeting = 'Good afternoon';
                else greeting = 'Good evening';

                userInfo.innerHTML = `
                    <strong>${greeting}, ${currentUser.name}!</strong><br>
                    <span class="user-tier ${tierClass}">${currentUser.plan.toUpperCase()} PLAN</span><br>
                    <small>Member since ${new Date(currentUser.joinedDate).toLocaleDateString()}</small>
                `;

                // User dashboard with personalized stats
                let dashboardHTML = '';

                if (currentUser.plan === 'free') {
                    dashboardHTML = `
                        <div style="text-align: center; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                            <strong>üìä Your Usage</strong><br>
                            <small>Searches used: ${currentUser.searchesUsed || 0}/5 today</small><br>
                            <small>Upgrade to Pro for unlimited searches!</small>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #fff3cd; border-radius: 8px;">
                            <strong>‚≠ê Pro Features</strong><br>
                            <small>Unlock unlimited AI searches</small><br>
                            <button class="btn" onclick="document.querySelector('.cta-section').scrollIntoView({behavior: 'smooth'})" style="padding: 5px 10px; font-size: 12px; margin-top: 5px;">Upgrade Now</button>
                        </div>
                    `;
                } else if (currentUser.plan === 'pro') {
                    dashboardHTML = `
                        <div style="text-align: center; padding: 10px; background: #e3f2fd; border-radius: 8px;">
                            <strong>üöÄ Pro Member</strong><br>
                            <small>Unlimited searches active</small><br>
                            <small>All premium features unlocked</small>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f3e5f5; border-radius: 8px;">
                            <strong>üíº Business Upgrade</strong><br>
                            <small>White-label API access</small><br>
                            <button class="btn" onclick="alert('Contact sales for Business plan: shubhmittal8971wc@gmail.com')" style="padding: 5px 10px; font-size: 12px; margin-top: 5px;">Learn More</button>
                        </div>
                    `;
                } else if (currentUser.plan === 'business') {
                    dashboardHTML = `
                        <div style="text-align: center; padding: 10px; background: #fff3e0; border-radius: 8px;">
                            <strong>üè¢ Business Member</strong><br>
                            <small>Enterprise features active</small><br>
                            <small>White-label API available</small>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                            <strong>üìû Support</strong><br>
                            <small>Dedicated account manager</small><br>
                            <small>Priority assistance</small>
                        </div>
                    `;
                }

                userDashboard.innerHTML = dashboardHTML;

                // Update CTA buttons based on user plan
                updateCTAButtons();

                // Update welcome message
                updateWelcomeMessage();
            } else {
                userBar.style.display = 'none';
            }
        }

        function updateWelcomeMessage() {
            const welcomeMessage = `<strong>üëã Welcome back, ${currentUser.name}!</strong><br>
                You're on the ${currentUser.plan.toUpperCase()} plan with ${currentUser.plan === 'free' ? 'limited' : 'unlimited'} searches.<br>
                Try our AI shopping assistant below!`;

            showResult('voiceResult', welcomeMessage, 'success');
        }

        function updateCTAButtons() {
            const ctaSection = document.querySelector('.cta-section');
            if (currentUser && currentUser.plan !== 'free') {
                // User already has a paid plan
                ctaSection.innerHTML = `
                    <div class="cta-title">üéâ Welcome to ${currentUser.plan.toUpperCase()} Plan!</div>
                    <div class="cta-subtitle">
                        Enjoy all premium features of WhisperCart.<br>
                        Your subscription is active and renewing automatically.
                    </div>
                    <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <strong>üìß Contact:</strong> shubhmittal8971wc@gmail.com<br>
                        <strong>üíº Business:</strong> AI Shopping Assistant Startup<br>
                        <strong>üéØ Mission:</strong> Make online shopping effortless and affordable for everyone<br>
                        <strong>üí≥ Your Plan:</strong> ${currentUser.plan.toUpperCase()} | Next billing: Monthly
                    </div>
                `;
            }
        }

        // Modal functions
        function showModal() {
            document.getElementById('authModal').style.display = 'block';
        }

        function closeModal() {
            // Close any open modal
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('productModal').style.display = 'none';
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        // Add event listeners as backup
        document.addEventListener('DOMContentLoaded', function() {
            const authCloseBtn = document.getElementById('authModalClose');
            const productCloseBtn = document.getElementById('productModalClose');

            if (authCloseBtn) {
                authCloseBtn.addEventListener('click', closeAuthModal);
            }
            if (productCloseBtn) {
                productCloseBtn.addEventListener('click', closeProductModal);
            }

            // Also add click outside modal to close
            document.getElementById('authModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAuthModal();
                }
            });

            document.getElementById('productModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeProductModal();
                }
            });
        });

        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('modalTitle').textContent = 'Welcome Back';
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('modalTitle').textContent = 'Join WhisperCart';
        }

        // User registration
        function registerUser() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const plan = document.getElementById('regPlan').value;

            if (!name || !email) {
                alert('Please fill in all fields');
                return;
            }

            // Check if user already exists
            const existingUsers = JSON.parse(localStorage.getItem('whispercart_users') || '[]');
            const userExists = existingUsers.find(user => user.email === email);

            if (userExists) {
                alert('An account with this email already exists. Please login instead.');
                showLogin();
                return;
            }

            // Create new user
            currentUser = {
                id: Date.now(),
                name: name,
                email: email,
                plan: plan,
                joinedDate: new Date().toISOString(),
                searchesUsed: 0,
                lastLogin: new Date().toISOString()
            };

            // Save to users list
            existingUsers.push(currentUser);
            localStorage.setItem('whispercart_users', JSON.stringify(existingUsers));

            // Save current user
            saveUserData();

            // Update UI
            updateUIForUser();
            closeModal();

            // Show welcome message
            alert(`üéâ Welcome to WhisperCart, ${name}!\n\nYou've successfully registered for the ${plan.toUpperCase()} plan.\n\n${plan === 'free' ? 'Start exploring our AI features!' : 'Your premium features are now unlocked!'}`);

            // Show upgrade prompt for free users
            if (plan === 'free') {
                setTimeout(() => {
                    if (confirm('Want to unlock unlimited searches and premium AI features? Upgrade to Pro plan now!')) {
                        // Scroll to pricing section
                        document.querySelector('.cta-section').scrollIntoView({ behavior: 'smooth' });
                    }
                }, 3000);
            }
        }

        // User login
        function loginUser() {
            const email = document.getElementById('loginEmail').value.trim();

            if (!email) {
                alert('Please enter your email');
                return;
            }

            // Find user
            const existingUsers = JSON.parse(localStorage.getItem('whispercart_users') || '[]');
            const user = existingUsers.find(user => user.email === email);

            if (!user) {
                alert('No account found with this email. Please register first.');
                showRegister();
                return;
            }

            // Login successful
            currentUser = user;
            currentUser.lastLogin = new Date().toISOString();
            saveUserData();

            // Update users list
            const userIndex = existingUsers.findIndex(u => u.id === user.id);
            existingUsers[userIndex] = currentUser;
            localStorage.setItem('whispercart_users', JSON.stringify(existingUsers));

            // Update UI
            updateUIForUser();
            closeModal();

            alert(`üëã Welcome back, ${user.name}!\n\nYou're logged in to your ${user.plan.toUpperCase()} plan.`);
        }

        // Logout
        function logoutUser() {
            currentUser = null;
            localStorage.removeItem('whispercart_user');
            updateUIForUser();
            alert('You have been logged out. Come back soon! üëã');
        }

        // Feature gating based on subscription
        function checkFeatureAccess(feature) {
            if (!currentUser) {
                showModal();
                return false;
            }

            if (currentUser.plan === 'free') {
                if (feature === 'unlimited_searches' && currentUser.searchesUsed >= 5) {
                    alert('You\'ve reached your 5 daily searches limit. Upgrade to Pro for unlimited searches!');
                    document.querySelector('.cta-section').scrollIntoView({ behavior: 'smooth' });
                    return false;
                }
                if (['advanced_filters', 'export_lists', 'price_history'].includes(feature)) {
                    alert(`This is a Pro feature! Upgrade to unlock ${feature.replace('_', ' ')}.`);
                    document.querySelector('.cta-section').scrollIntoView({ behavior: 'smooth' });
                    return false;
                }
            }

            if (currentUser.plan === 'pro') {
                if (['white_label', 'custom_integrations', 'team_tools'].includes(feature)) {
                    alert(`This is a Business feature! Contact sales for enterprise solutions.`);
                    return false;
                }
            }

            return true;
        }

        // Track usage for free users
        function trackUsage(feature) {
            if (currentUser && currentUser.plan === 'free') {
                if (feature === 'search') {
                    currentUser.searchesUsed++;
                    saveUserData();
                }
            }
        }

        // Product Modal Functions
        let currentProductUrl = '';

        function showProductModal(productIndex, category, price, store, savings, userTier, name, url) {
            try {
                // Update modal content
                document.getElementById('productEmoji').textContent = getEmojiForCategory(category);
                document.getElementById('productName').textContent = name;
                document.getElementById('productPrice').textContent = `‚Çπ${price.toLocaleString()}`;
                document.getElementById('productStore').textContent = store;
                document.getElementById('productSavings').textContent = `Save ‚Çπ${savings.toLocaleString()}`;

                // Generate purchase URL
                currentProductUrl = generateAffiliateUrl(url || '#');

                // Show tier benefits
                let tierBenefits = '';
                if (userTier === 'free') {
                    tierBenefits = `
                        <strong>üéÅ Free Plan Benefits:</strong><br>
                        ‚Ä¢ AI-negotiated prices (15% savings)<br>
                        ‚Ä¢ Basic product search<br>
                        ‚Ä¢ Limited to 5 searches/day<br><br>
                        <strong>üí° Upgrade to Pro for 25% better deals!</strong>
                    `;
                } else if (userTier === 'pro') {
                    tierBenefits = `
                        <strong>üöÄ Pro Exclusive Benefits:</strong><br>
                        ‚Ä¢ 25% better prices than Free users<br>
                        ‚Ä¢ Unlimited searches<br>
                        ‚Ä¢ Premium AI features<br>
                        ‚Ä¢ Priority support
                    `;
                } else if (userTier === 'business') {
                    tierBenefits = `
                        <strong>üè¢ Business Elite Benefits:</strong><br>
                        ‚Ä¢ Maximum 30% savings<br>
                        ‚Ä¢ Bulk discount pricing<br>
                        ‚Ä¢ Enterprise features<br>
                        ‚Ä¢ Dedicated support
                    `;
                }

                document.getElementById('tierBenefits').innerHTML = tierBenefits;

                // Show modal
                document.getElementById('productModal').style.display = 'block';

            } catch (error) {
                console.error('Error loading product modal:', error);
                alert('Sorry, there was an error loading the product details.');
            }
        }

        function proceedToPurchase() {
            if (currentProductUrl) {
                openAffiliateLink(currentProductUrl);
                closeModal();
            } else {
                alert('Product link not available. Please try another product.');
            }
        }

        function demoPurchase() {
            // Create a full shopping experience simulation
            const purchaseFlow = [
                { step: 1, message: "üõí Adding product to cart...", delay: 1000 },
                { step: 2, message: "ü§ñ AI negotiating with seller for better price...", delay: 2000 },
                { step: 3, message: "üí∞ AI secured ‚Çπ500 additional discount!", delay: 1500 },
                { step: 4, message: "üöö Checking for free shipping eligibility...", delay: 1000 },
                { step: 5, message: "‚úÖ Free shipping unlocked on ‚Çπ2000+ orders!", delay: 1500 },
                { step: 6, message: "üí≥ Processing secure payment...", delay: 2000 },
                { step: 7, message: "üéâ Order confirmed! Track your delivery in real-time.", delay: 1500 },
                { step: 8, message: "üìß Confirmation email sent to your inbox.", delay: 1000 }
            ];

            // Create overlay for purchase experience
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;

            const purchaseCard = document.createElement('div');
            purchaseCard.style.cssText = `
                background: white;
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                max-width: 500px;
                width: 90%;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            `;

            purchaseCard.innerHTML = `
                <div style="font-size: 3em; margin-bottom: 20px;">üõí</div>
                <h2 style="color: #4CAF50; margin-bottom: 30px;">AI Shopping Experience</h2>
                <div id="purchaseStatus" style="font-size: 18px; margin-bottom: 30px; min-height: 50px;">Starting purchase process...</div>
                <div id="purchaseProgress" style="width: 100%; height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin-bottom: 20px;">
                    <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(45deg, #667eea, #764ba2); transition: width 0.5s ease;"></div>
                </div>
                <button id="closePurchase" style="background: #4CAF50; color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; display: none;">Continue Shopping</button>
            `;

            overlay.appendChild(purchaseCard);
            document.body.appendChild(overlay);

            let currentStep = 0;

            function showNextStep() {
                if (currentStep < purchaseFlow.length) {
                    const step = purchaseFlow[currentStep];
                    document.getElementById('purchaseStatus').textContent = step.message;

                    // Update progress bar
                    const progressPercent = ((currentStep + 1) / purchaseFlow.length) * 100;
                    document.getElementById('progressBar').style.width = progressPercent + '%';

                    currentStep++;

                    setTimeout(showNextStep, step.delay);
                } else {
                    // Purchase complete
                    document.getElementById('purchaseStatus').innerHTML = `
                        <div style="color: #4CAF50; font-size: 20px; font-weight: bold; margin-bottom: 15px;">üéâ Purchase Complete!</div>
                        <div style="font-size: 16px; color: #666;">
                            ‚Ä¢ Product delivered to cart<br>
                            ‚Ä¢ ‚Çπ500 AI-negotiated discount applied<br>
                            ‚Ä¢ Free shipping unlocked<br>
                            ‚Ä¢ Order confirmed & tracked<br><br>
                            <strong style="color: #FF9800;">üí∞ Commission earned: ‚Çπ150</strong><br>
                            <small style="color: #999;">(This demonstrates real affiliate earnings)</small>
                        </div>
                    `;

                    document.getElementById('closePurchase').style.display = 'block';
                }
            }

            // Start the purchase flow
            setTimeout(showNextStep, 500);

            // Close button functionality
            document.getElementById('closePurchase').onclick = function() {
                overlay.remove();
            };

            // Close on overlay click
            overlay.onclick = function(e) {
                if (e.target === overlay) {
                    overlay.remove();
                }
            };
        }

        // Alternative product info display (no modal)
        function showProductInfo(divId, productIndex, category, price, store, savings, userTier, name, url) {
            try {
                const affiliateUrl = generateAffiliateUrl(url || '#');

                // Create a simple info display instead of modal
                const infoHTML = `
                    <div style="background: #e8f5e8; border: 2px solid #4CAF50; border-radius: 15px; padding: 20px; margin: 15px 0;">
                        <h3 style="color: #2e7d32; margin-bottom: 15px;">üõí Product Details</h3>

                        <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <strong style="font-size: 1.2em;">${name}</strong><br>
                            <span style="color: #4CAF50; font-size: 1.5em; font-weight: bold;">‚Çπ${price.toLocaleString()}</span><br>
                            <small style="color: #666;">Store: ${store} | Savings: ‚Çπ${savings.toLocaleString()}</small>
                        </div>

                        <div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <strong>Your Plan Benefits:</strong><br>
                            ${userTier === 'free' ? 'üéÅ 15% AI-negotiated discount applied' :
                              userTier === 'pro' ? 'üöÄ 25% Pro exclusive discount applied' :
                              'üè¢ 30% Business elite discount applied'}
                        </div>

                        <button onclick="demoPurchase()" style="background: #4CAF50; color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold;">
                            üéØ Experience AI Purchase
                        </button>

                        <button onclick="this.parentElement.style.display='none'" style="background: #666; color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; margin-left: 10px; font-size: 12px;">
                            Close
                        </button>
                    </div>
                `;

                // Find the result div and add the info after it
                const resultDiv = document.getElementById(divId);
                if (resultDiv) {
                    // Remove any existing product info
                    const existingInfo = resultDiv.querySelector('.product-info-display');
                    if (existingInfo) {
                        existingInfo.remove();
                    }

                    // Add new product info
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'product-info-display';
                    infoDiv.innerHTML = infoHTML;
                    resultDiv.appendChild(infoDiv);
                }

            } catch (error) {
                console.error('Error showing product info:', error);
                alert('Sorry, there was an error displaying the product details.');
            }
        }

        function getEmojiForCategory(category) {
            const emojiMap = {
                'running shoes': 'üëü',
                'smartphones': 'üì±',
                'laptops': 'üíª',
                'headphones': 'üéß',
                'watches': '‚åö'
            };
            return emojiMap[category] || 'üõí';
        }

        // Voice input functionality using Web Speech API
        let recognition = null;

        function startVoiceInput() {
            const voiceInput = document.getElementById('voiceInput');
            const voiceStatus = document.getElementById('voiceStatus');
            const voiceBtn = document.getElementById('voiceBtn');

            // Check if browser supports speech recognition
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                voiceStatus.style.display = 'block';
                voiceStatus.textContent = '‚ùå Voice input not supported in this browser. Please type your request instead.';
                voiceStatus.style.color = '#f44336';
                return;
            }

            // Check if we're on HTTPS (required for voice input)
            if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                voiceStatus.style.display = 'block';
                voiceStatus.textContent = 'üîí Voice input requires HTTPS. Deploy to production or use localhost for voice features.';
                voiceStatus.style.color = '#FF9800';
                return;
            }

            // Request microphone permission and initialize
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function(stream) {
                        // Permission granted, proceed with voice recognition
                        initializeVoiceRecognition();
                        // Stop the stream immediately as we don't need it for speech recognition
                        stream.getTracks().forEach(track => track.stop());
                    })
                    .catch(function(error) {
                        console.error('Microphone permission denied:', error);
                        voiceStatus.style.display = 'block';
                        voiceStatus.textContent = 'üé§ Microphone access denied. Please allow microphone access and try again, or type your request.';
                        voiceStatus.style.color = '#f44336';
                    });
            } else {
                // Fallback for older browsers
                initializeVoiceRecognition();
            }

            function initializeVoiceRecognition() {
                try {
                    // Initialize speech recognition
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognition = new SpeechRecognition();

                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.lang = 'en-IN'; // Indian English

                    // Visual feedback
                    voiceStatus.style.display = 'block';
                    voiceStatus.textContent = 'üé§ Listening... Speak now! (Click "Allow" if prompted for microphone)';
                    voiceStatus.style.color = '#4CAF50';
                    voiceBtn.style.background = '#f44336';

                    recognition.onstart = function() {
                        console.log('Voice recognition started');
                        voiceStatus.textContent = 'üé§ Listening... Speak your shopping request now!';
                    };

                    recognition.onresult = function(event) {
                        const transcript = event.results[0][0].transcript;
                        console.log('Voice transcript:', transcript);

                        voiceInput.value = transcript;
                        voiceStatus.textContent = '‚úÖ Voice captured: "' + transcript + '"';
                        voiceStatus.style.color = '#4CAF50';
                        voiceBtn.style.background = '#4CAF50';

                        // Auto-process after 1 second
                        setTimeout(() => {
                            processVoice();
                        }, 1000);
                    };

                    recognition.onerror = function(event) {
                        console.error('Speech recognition error:', event.error, event);

                        let errorMessage = '‚ùå Voice recognition failed.';
                        if (event.error === 'not-allowed') {
                            errorMessage += ' Microphone access denied. Please allow microphone access and try again.';
                        } else if (event.error === 'no-speech') {
                            errorMessage += ' No speech detected. Please speak clearly and try again.';
                        } else if (event.error === 'network') {
                            errorMessage += ' Network error. Check your internet connection.';
                        } else {
                            errorMessage += ' Please try again or type your request instead.';
                        }

                        voiceStatus.textContent = errorMessage;
                        voiceStatus.style.color = '#f44336';
                        voiceBtn.style.background = '#4CAF50';
                    };

                    recognition.onend = function() {
                        console.log('Voice recognition ended');
                        // Reset button after a delay
                        setTimeout(() => {
                            voiceBtn.style.background = '#4CAF50';
                        }, 2000);
                    };

                    recognition.start();
                } catch (error) {
                    console.error('Error initializing voice recognition:', error);
                    voiceStatus.style.display = 'block';
                    voiceStatus.textContent = '‚ùå Voice recognition not available. Please type your request instead.';
                    voiceStatus.style.color = '#f44336';
                    voiceBtn.style.background = '#4CAF50';
                }
            }
        }

        // Initialize with welcome message
        setTimeout(() => {
            let welcomeMessage = '<strong>üëã Welcome to WhisperCart!</strong><br>';
            if (currentUser) {
                welcomeMessage += `Hello ${currentUser.name}! `;
            }
            welcomeMessage += 'Try typing: "I want running shoes under 3000 rupees"<br>Or click the üé§ microphone to speak your request!<br>Or click "Show Random Demo" to see AI in action!';

            if (!currentUser) {
                welcomeMessage += '<br><br><button class="btn" onclick="showModal()" style="margin-top: 10px; padding: 8px 16px; font-size: 14px;">Join WhisperCart</button>';
            }

            showResult('voiceResult', welcomeMessage, 'success');
        }, 500);
    </script>
</body>
</html>
